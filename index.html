<!DOCTYPE html>
<html>
<head>
    <title>One Night Werewolf</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a2e; color: white; text-align: center; padding: 20px; }
        .hidden { display: none; }
        .btn { background: #e94560; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; }
        .player-btn { background: #16213e; border: 1px solid #e94560; color: white; padding: 10px; margin: 5px; cursor: pointer; }
        .player-btn:disabled { opacity: 0.5; }
        #list { margin: 20px; border: 1px solid #444; padding: 10px; }
    </style>
</head>
<body>
    <div id="lobby">
        <h1>Werewolf Lobby</h1>
        <input id="nameInput" placeholder="Your Name" style="padding: 10px;">
        <button class="btn" onclick="join()">Join Game</button>
        <div id="list">Waiting for players...</div>
        <button id="startBtn" class="btn hidden" onclick="start()">Start Game (5 Players)</button>
    </div>

    <div id="game" class="hidden">
        <h2 id="roleReveal"></h2>
        <div id="actionText"></div>
        <div id="buttonArea"></div>
        <br>
        <button id="doneBtn" class="btn hidden" onclick="finishTurn()" style="background: #0f3460;">I am Done</button>
    </div>

    <div id="morning" class="hidden">
        <h1>☀️ Morning Phase</h1>
        <p>Discuss and vote! Here are the final roles:</p>
        <div id="finalRolesList"></div>
        <button class="btn" onclick="location.reload()">Play Again</button>
    </div>

    <script>
        const socket = io();
        let myRole = "";
        let selectedForSwap = [];

        function join() {
            const name = document.getElementById('nameInput').value;
            if(name) socket.emit('joinGame', name);
        }

        function start() { socket.emit('startGame'); }

        socket.on('playerListUpdate', (names) => {
            document.getElementById('list').innerText = "Players: " + names.join(', ');
            if(names.length === 5) document.getElementById('startBtn').classList.remove('hidden');
        });

        socket.on('assignRole', (data) => {
            myRole = data.role;
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            document.getElementById('roleReveal').innerText = "Your Secret Role: " + myRole;
            setupAction(data.role, data.allPlayers);
        });

        function setupAction(role, players) {
            const area = document.getElementById('buttonArea');
            const text = document.getElementById('actionText');
            area.innerHTML = "";

            if (role === 'Seer') {
                text.innerText = "Seer: Click one player to see their role.";
                players.forEach((name, i) => {
                    let b = document.createElement('button');
                    b.innerText = name;
                    b.className = "player-btn";
                    b.onclick = () => { socket.emit('seerAction', i); b.disabled = true; };
                    area.appendChild(b);
                });
            } else if (role === 'Gremlin') {
                text.innerText = "Gremlin: Click TWO players to swap their roles.";
                players.forEach((name, i) => {
                    let b = document.createElement('button');
                    b.innerText = name;
                    b.className = "player-btn";
                    b.onclick = () => {
                        selectedForSwap.push(i);
                        b.disabled = true;
                        if(selectedForSwap.length === 2) {
                            socket.emit('gremlinAction', selectedForSwap);
                            area.innerHTML = "Roles Swapped!";
                        }
                    };
                    area.appendChild(b);
                });
            } else {
                text.innerText = "You have no night action. Wait for the morning.";
            }
            document.getElementById('doneBtn').classList.remove('hidden');
        }

        socket.on('seerResult', (msg) => alert(msg));
        socket.on('gremlinResult', (msg) => alert(msg));

        function finishTurn() {
            socket.emit('playerFinished');
            document.getElementById('doneBtn').classList.add('hidden');
            document.getElementById('actionText').innerText = "Waiting for others...";
            document.getElementById('buttonArea').innerHTML = "";
        }

        socket.on('morningPhase', (finalData) => {
            document.getElementById('game').classList.add('hidden');
            document.getElementById('morning').classList.remove('hidden');
            const list = document.getElementById('finalRolesList');
            list.innerHTML = finalData.map(p => `<p><strong>${p.name}:</strong> ${p.role}</p>`).join('');
        });
    </script>
</body>
</html>
